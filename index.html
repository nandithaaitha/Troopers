<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="User registration form with accessibility features" />
    <title>User Registration - Accessible Form</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script type="module" src="./js/firebaseauth.js" aria-hidden="true"></script>
  </head>
  <body>
    <a href="#main-content" class="skip-link visually-hidden-focusable">Skip to Content</a>
    
    <main id="main-content" role="main">
      <div class="container">
        <div class="form-box">
          <h1 id="form-title">Registration</h1>

          <!-- Error Summary Container -->
          <div 
            id="error-container" 
            class="alert alert-danger visually-hidden" 
            role="alert" 
            aria-atomic="true">
          </div>
          
          <!-- Success Message -->
          <div
            id="signUpMessage"
            class="alert alert-success visually-hidden"
            role="alert"
            aria-live="polite"
          ></div>

          <form 
            id="registrationForm" 
            aria-labelledby="form-title"
            aria-describedby="form-instructions"
            novalidate>
          

            <!-- First Name -->
            <div class="mb-3">
              <label for="first-name" class="form-label">
                First Name 
                <span class="text-danger" aria-hidden="true">*</span>
                <span class="visually-hidden">required</span>
              </label>
              <input
                type="text"
                id="first-name"
                name="first_name"
                class="form-control"
                required
                aria-required="true"
                aria-describedby="first-name-error"
              />
              <div id="first-name-error" class="invalid-feedback"></div>
            </div>

            <!-- Last Name -->
            <div class="mb-3">
              <label for="last-name" class="form-label">
                Last Name
                <span class="text-danger" aria-hidden="true">*</span>
                <span class="visually-hidden">required</span>
              </label>
              <input
                type="text"
                id="last-name"
                name="last_name"
                class="form-control"
                required
                aria-required="true"
                aria-describedby="last-name-error"
              />
              <div id="last-name-error" class="invalid-feedback"></div>
            </div>

            <!-- Email -->
            <div class="mb-3">
              <label for="email" class="form-label">
                Email
                <span class="text-danger" aria-hidden="true">*</span>
                <span class="visually-hidden">required</span>
              </label>
              <input
                type="email"
                id="email"
                name="email"
                class="form-control"
                required
                aria-required="true"
                aria-describedby="email-help email-error"
              />
              <div id="email-help" class="form-text">We'll never share your email with anyone else.</div>
              <div id="email-error" class="invalid-feedback"></div>
            </div>

            <!-- Password -->
            <div class="mb-3">
              <label for="password" class="form-label">
                Password
                <span class="text-danger" aria-hidden="true">*</span>
                <span class="visually-hidden">required</span>
              </label>
              <input
                type="password"
                id="password"
                name="password"
                class="form-control"
                required
                aria-required="true"
                aria-describedby="password-help password-error"
                minlength="8"
              />
              <div id="password-help" class="form-text">Password must be at least 8 characters long.</div>
              <div id="password-error" class="invalid-feedback"></div>
            </div>

            <!-- Date of Birth -->
            <div class="mb-3">
              <label for="dob" class="form-label">
                Date of Birth
                <span class="text-danger" aria-hidden="true">*</span>
                <span class="visually-hidden">required</span>
              </label>
              <input
                type="date"
                id="dob"
                name="dob"
                class="form-control"
                required
                aria-required="true"
                aria-describedby="dob-error"
              />
              <div id="dob-error" class="invalid-feedback"></div>
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              id="create-user"
              class="btn btn-primary w-100 mt-3"
            >
              Create User
            </button>
          </form>

          <a href="login.html" class="exist-link d-block mt-3 text-center">
            Already Registered? Log in here
          </a>
        </div>
      </div>
    </main>

    <!-- Add JavaScript for form validation -->
    <script>
      document.getElementById('registrationForm').addEventListener('submit', function(event) {
        event.preventDefault();
        
        // Clear previous errors
        const errorContainer = document.getElementById('error-container');
        errorContainer.classList.add('visually-hidden');
        errorContainer.innerHTML = '';
        
        // Reset all fields
        document.querySelectorAll('.is-invalid').forEach(field => {
          field.classList.remove('is-invalid');
        });
        
        let errors = [];
        const fields = ['first-name', 'last-name', 'email', 'password', 'dob'];
        
        // Validate each field
        fields.forEach(fieldId => {
          const field = document.getElementById(fieldId);
          const errorDiv = document.getElementById(`${fieldId}-error`);
          
          if (!field.value) {
            field.classList.add('is-invalid');
            errorDiv.textContent = 'This field is required';
            errors.push(`${field.labels[0].textContent.trim().replace('*', '')} is required`);
          }
        });
        
        // Special validation for email format
        const email = document.getElementById('email');
        if (email.value && !email.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
          email.classList.add('is-invalid');
          document.getElementById('email-error').textContent = 'Please enter a valid email address';
          errors.push('Please enter a valid email address');
        }
        
        // Special validation for password length
        const password = document.getElementById('password');
        if (password.value && password.value.length < 8) {
          password.classList.add('is-invalid');
          document.getElementById('password-error').textContent = 'Password must be at least 8 characters long';
          errors.push('Password must be at least 8 characters long');
        }
        
        // If there are errors, display them
        if (errors.length > 0) {
          errorContainer.classList.remove('visually-hidden');
          errorContainer.innerHTML = `
            <h2 class="h6">Please correct the following errors:</h2>
            <ul>
              ${errors.map(error => `<li>${error}</li>`).join('')}
            </ul>
          `;
          // Focus the error container for screen readers
          errorContainer.focus();
        } else {
          // If no errors, you can submit the form
          // Your existing form submission code here
        }
      });
    </script>
  </body>
</html>
